<!doctype html>
<html lang="vi" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Katalyst</title>
    <link rel="stylesheet" href="/styles.css" />
    <link rel="icon" type="image/png" href="/asset/Gemini_Generated_Image_xdmpsyxdmpsyxdmp.png" />
    <link rel="shortcut icon" type="image/png" href="/asset/Gemini_Generated_Image_xdmpsyxdmpsyxdmp.png" />
  </head>
  <body>
    <!-- Auth Check - B·∫Øt bu·ªôc login -->
    <script type="module">
      import { auth } from './js/auth.js';
      
      // Check authentication
      if (!auth.isAuthenticated()) {
        window.location.href = '/login.html';
      }
      
      // Display user info when DOM is ready
        window.addEventListener('DOMContentLoaded', () => {
          const user = auth.getUser();
          if (user) {
            const displayNameEl = document.getElementById('userDisplayName');
            const roleEl = document.getElementById('userRole');
            const avatarEl = document.getElementById('userAvatar');
            
            if (displayNameEl) displayNameEl.textContent = user.username;
            if (roleEl) roleEl.textContent = user.role;
            if (avatarEl) avatarEl.textContent = user.username.charAt(0).toUpperCase();
            
            // Show/hide admin-only features
            if (!auth.isAdmin()) {
              document.querySelectorAll('.admin-only').forEach(el => {
                el.style.display = 'none';
              });
            }
          }
        });
      
      // Global logout function
      window.handleLogout = async () => {
        if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
          await auth.logout();
        }
      };
      
      // Make auth available globally for other scripts
      window.auth = auth;
    </script>

    <header class="app-header">
      <div class="header-left">
        <button id="sidebarToggle" class="btn icon-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </button>
        <div class="brand">
          <div class="logo"><img src="/asset/Gemini_Generated_Image_xdmpsyxdmpsyxdmp.png" alt="Logo" /></div>
          <div>
            <h1>K-Talyst</h1>
            <p class="muted brand-subtitle">Qu·∫£n l√Ω c·∫•u h√¨nh, build, deploy v√† theo d√µi realtime.</p>
          </div>
        </div>
      </div>
      <div class="header-actions">
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">U</div>
          <div class="user-info-content">
            <span class="user-name" id="userDisplayName">User</span>
            <span class="user-role" id="userRole">role</span>
          </div>
        </div>
        <button id="themeToggle" class="btn secondary">Ch·∫ø ƒë·ªô t·ªëi</button>
        <button id="logoutBtn" class="btn danger" onclick="handleLogout()">ƒêƒÉng xu·∫•t</button>
      </div>
    </header>
    <div class="layout">
      <!-- Sidebar Navigation -->
      <aside class="sidebar">
        <nav class="side-nav">
          <button class="tab-btn" data-tab="jobs-tab">üìã Qu·∫£n l√Ω Jobs</button>
          <button class="tab-btn" data-tab="queue-tab">‚è≥ H√†ng ƒë·ª£i Build</button>
          <button class="tab-btn" data-tab="builds-tab">üöÄ Qu·∫£n l√Ω Builds</button>
          <button class="tab-btn" data-tab="repository-tab">üìÅ Repository Browser</button>
          <!-- <button class="tab-btn" data-tab="raw-config-tab">üìù config.json</button> -->
          <button class="tab-btn active" data-tab="config-tab">‚öôÔ∏è C·∫•u h√¨nh chung</button>
          <button class="tab-btn admin-only" data-tab="database-tab">üóÑÔ∏è Database</button>
        </nav>
      </aside>

      <main class="container tab-container">
      <!-- Tab 1: C·∫•u h√¨nh chung -->
      <div id="config-tab" class="tab-content active">
        <!-- Git Configuration Section -->
        <section class="card">
          <h2>üîó C·∫•u h√¨nh Git Repository</h2>
          <div class="row">
            <div>
              <label for="provider">Nh√† cung c·∫•p</label>
              <select id="provider">
                <option value="gitlab">GitLab</option>
                <option value="github">GitHub</option>
              </select>
            </div>
            <div>
              <label for="polling">Chu k·ª≥ polling (gi√¢y)</label>
              <input id="polling" type="number" min="5" step="5" placeholder="30" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="account">T√†i kho·∫£n / T·ªï ch·ª©c</label>
              <input id="account" type="text" placeholder="vd: my-org" />
            </div>
            <div>
              <label for="token">Access Token</label>
              <input id="token" type="password" placeholder="ghp_/glpat_..." />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="repoUrl">Repo URL</label>
              <input id="repoUrl" type="text" placeholder="https://gitlab.com/my-org/my-repo.git" />
              <p class="muted">Repo s·∫Ω ƒë∆∞·ª£c pull t·ª± ƒë·ªông v√†o <code>&lt;contextInitPath&gt;/Katalyst/repo</code>.</p>
            </div>
          </div>
          <div class="row">
            <div>
              <label for="branch">Branch</label>
              <input id="branch" type="text" placeholder="main" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="contextInitPath">ƒê∆∞·ªùng d·∫´n kh·ªüi t·∫°o Context</label>
              <input id="contextInitPath" type="text" placeholder="vd: D:/workspace" />
              <p class="muted">Khi l∆∞u c·∫•u h√¨nh, h·ªá th·ªëng s·∫Ω t·∫°o th∆∞ m·ª•c <strong>Katalyst</strong> t·∫°i ƒë∆∞·ªùng d·∫´n n√†y, bao g·ªìm <code>repo</code> v√† <code>builder</code>.</p>
            </div>
          </div>
          <div class="actions">
            <button id="saveCfg" class="btn">L∆∞u c·∫•u h√¨nh Git</button>
            <button id="checkConnection" class="btn outline">Ki·ªÉm tra k·∫øt n·ªëi</button>
          </div>
          <p id="cfgStatus" class="status"></p>
        </section>

        <!-- Email Configuration Section -->
        <section class="card">
          <h2>üìß C·∫•u h√¨nh Email th√¥ng b√°o</h2>
          <div class="row">
            <div>
              <label for="smtpHost">SMTP Host</label>
              <input id="smtpHost" type="text" placeholder="smtp.gmail.com" />
            </div>
            <div>
              <label for="smtpPort">SMTP Port</label>
              <input id="smtpPort" type="number" placeholder="587" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="emailUser">Email ng∆∞·ªùi g·ª≠i</label>
              <input id="emailUser" type="email" placeholder="ci-cd@company.com" />
            </div>
            <div>
              <label for="emailPassword">M·∫≠t kh·∫©u Email</label>
              <input id="emailPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="notifyEmails">Email nh·∫≠n th√¥ng b√°o</label>
              <input id="notifyEmails" type="text" placeholder="dev1@company.com, dev2@company.com" />
              <p class="muted">Nh·∫≠p nhi·ªÅu email c√°ch nhau b·∫±ng d·∫•u ph·∫©y</p>
            </div>
          </div>
          <div class="check-inline">
            <input id="enableEmailNotify" class="switch" type="checkbox" />
            <span>B·∫≠t th√¥ng b√°o email khi build th√†nh c√¥ng/th·∫•t b·∫°i</span>
          </div>
          <div class="actions">
            <button id="saveEmailConfig" class="btn">L∆∞u c·∫•u h√¨nh Email</button>
            <button id="testEmail" class="btn outline">G·ª≠i email test</button>
          </div>
        </section>

        <!-- Security & Secrets Configuration Section -->
        <section class="card">
          <h2>üîê C·∫•u h√¨nh B·∫£o m·∫≠t & Secrets</h2>
          <div class="row">
            <div>
              <label for="webhookSecret">Webhook Secret</label>
              <input id="webhookSecret" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
              <p class="muted">Secret ƒë·ªÉ x√°c th·ª±c webhook t·ª´ Git provider</p>
            </div>
            <div>
              <label for="apiKey">API Key (cho external calls)</label>
              <input id="apiKey" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
              <p class="muted">Key ƒë·ªÉ b·∫£o v·ªá c√°c API endpoints</p>
            </div>
          </div>
          <div class="row">
            <div>
              <label for="encryptionKey">Encryption Key</label>
              <input id="encryptionKey" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
              <p class="muted">Key ƒë·ªÉ m√£ h√≥a d·ªØ li·ªáu nh·∫°y c·∫£m</p>
            </div>
          </div>
          <div class="actions">
            <button id="saveSecurityConfig" class="btn">L∆∞u c·∫•u h√¨nh B·∫£o m·∫≠t</button>
            <button id="generateKeys" class="btn outline">T·∫°o keys t·ª± ƒë·ªông</button>
          </div>
        </section>

        <!-- System Configuration Section -->
        <section class="card">
          <h2>‚öôÔ∏è C·∫•u h√¨nh H·ªá th·ªëng</h2>
          <div class="row">
            <div>
              <label for="maxConcurrentBuilds">S·ªë build ƒë·ªìng th·ªùi t·ªëi ƒëa</label>
              <input id="maxConcurrentBuilds" type="number" placeholder="1" min="1" max="10" />
              <p class="muted">Gi·ªõi h·∫°n s·ªë l∆∞·ª£ng build ch·∫°y c√πng l√∫c (khuy·∫øn ngh·ªã: 1 cho m√°y y·∫øu)</p>
            </div>
            <div>
              <label for="buildTimeout">Timeout build (ph√∫t)</label>
              <input id="buildTimeout" type="number" placeholder="30" min="5" max="120" />
              <p class="muted">Th·ªùi gian t·ªëi ƒëa cho m·ªôt l·∫ßn build</p>
            </div>
          </div>
          <div class="row">
            <div>
              <label for="logRetentionDays">L∆∞u tr·ªØ log (ng√†y)</label>
              <input id="logRetentionDays" type="number" placeholder="30" min="1" max="365" />
              <p class="muted">S·ªë ng√†y l∆∞u tr·ªØ log build</p>
            </div>
            <div>
              <label for="diskSpaceThreshold">Ng∆∞·ª°ng c·∫£nh b√°o ·ªï ƒëƒ©a (%)</label>
              <input id="diskSpaceThreshold" type="number" placeholder="80" min="50" max="95" />
              <p class="muted">C·∫£nh b√°o khi ·ªï ƒëƒ©a s·ª≠ d·ª•ng qu√° % n√†y</p>
            </div>
          </div>
          <div class="actions">
            <button id="saveSystemConfig" class="btn">L∆∞u c·∫•u h√¨nh H·ªá th·ªëng</button>
            <button id="resetToDefault" class="btn outline">Kh√¥i ph·ª•c m·∫∑c ƒë·ªãnh</button>
          </div>
        </section>
      </div>

      <!-- Tab 2: Build & Deploy (ƒë√£ lo·∫°i b·ªè theo y√™u c·∫ßu) -->

      <!-- Tab 3: Qu·∫£n l√Ω Jobs -->
      <div id="jobs-tab" class="tab-content">
        <!-- Jobs List Section -->
        <section class="card">
          <h2>üìã Danh s√°ch Jobs</h2>
          <div class="jobs-header">
            <div class="jobs-actions">
              <button id="createJobBtn" class="btn primary">‚ûï T·∫°o Job m·ªõi</button>
              <button id="refreshJobsBtn" class="btn outline">üîÑ L√†m m·ªõi</button>
            </div>
            <div class="jobs-search">
              <input type="text" id="jobSearch" placeholder="üîç T√¨m ki·∫øm jobs..." />
            </div>
          </div>
          
          <div class="jobs-table-container">
            <table class="jobs-table">
              <thead>
                <tr>
                  <th>T√™n Job</th>
                  <th>Tr·∫°ng th√°i</th>
                  <th>Ph∆∞∆°ng th·ª©c Build</th>
                  <th>Services</th>
                  <th>Build cu·ªëi</th>
                  <th>Tr·∫°ng th√°i Build cu·ªëi</th>
                  <th>Thao t√°c</th>
                </tr>
              </thead>
              <tbody id="jobsTableBody">
                <!-- Jobs will be populated here -->
              </tbody>
            </table>
          </div>
        </section>

        <!-- Job Statistics Section -->
        <section class="card">
          <h2>üìä Th·ªëng k√™ Jobs</h2>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-number" id="totalJobs">0</div>
              <div class="stat-label">T·ªïng Jobs</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="activeJobs">0</div>
              <div class="stat-label">Jobs ƒëang ho·∫°t ƒë·ªông</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="totalBuilds">0</div>
              <div class="stat-label">T·ªïng l∆∞·ª£t build</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="successfulBuilds">0</div>
              <div class="stat-label">Builds th√†nh c√¥ng</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="failedBuilds">0</div>
              <div class="stat-label">Builds th·∫•t b·∫°i</div>
            </div>
          </div>
        </section>
      </div>

      <!-- Tab 3: H√†ng ƒë·ª£i Build -->
      <div id="queue-tab" class="tab-content">
        <!-- Queue Status Section -->
        <section class="card">
          <h2>‚è≥ Tr·∫°ng th√°i H√†ng ƒë·ª£i</h2>
          <div class="queue-controls">
            <button id="refreshQueueBtn" class="btn outline">üîÑ L√†m m·ªõi</button>
            <button id="toggleQueueBtn" class="btn primary">‚è∏Ô∏è T·∫°m d·ª´ng Queue</button>
            <button id="clearQueueBtn" class="btn danger">üóëÔ∏è X√≥a h√†ng ƒë·ª£i</button>
          </div>
          
          <!-- Queue Statistics -->
          <div class="queue-stats">
            <div class="stat-card">
              <div class="stat-number" id="queueLength">0</div>
              <div class="stat-label">ƒêang ch·ªù</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="runningJobs">0</div>
              <div class="stat-label">ƒêang ch·∫°y</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="completedJobs">0</div>
              <div class="stat-label">Ho√†n th√†nh</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="failedJobs">0</div>
              <div class="stat-label">Th·∫•t b·∫°i</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="avgExecutionTime">0ms</div>
              <div class="stat-label">Th·ªùi gian TB</div>
            </div>
          </div>
        </section>

        <!-- Queue Configuration -->
        <section class="card">
          <h2>‚öôÔ∏è C·∫•u h√¨nh Queue</h2>
          <div class="form-row">
            <div class="form-group">
              <label for="maxConcurrentJobs">S·ªë job ƒë·ªìng th·ªùi t·ªëi ƒëa:</label>
              <input type="number" id="maxConcurrentJobs" min="1" max="5" value="1" />
              <small>Khuy·∫øn ngh·ªã: 1-2 cho m√°y y·∫øu</small>
            </div>
            <div class="form-group">
              <label for="resourceThreshold">Ng∆∞·ª°ng t√†i nguy√™n (%):</label>
              <input type="number" id="resourceThreshold" min="50" max="95" />
              <small>D·ª´ng queue khi CPU/Memory > ng∆∞·ª°ng n√†y</small>
            </div>
          </div>
          <div class="actions">
            <button id="saveQueueConfig" class="btn primary">üíæ L∆∞u c·∫•u h√¨nh</button>
          </div>
        </section>

        <!-- Running Jobs -->
        <section class="card">
          <h2>üèÉ‚Äç‚ôÇÔ∏è Jobs ƒëang ch·∫°y</h2>
          <div class="running-jobs-list" id="runningJobsList">
            <div class="empty-state">Kh√¥ng c√≥ job n√†o ƒëang ch·∫°y</div>
          </div>
        </section>

        <!-- Queue List -->
        <section class="card">
          <h2>üìã H√†ng ƒë·ª£i</h2>
          <div class="queue-list" id="queueList">
            <div class="empty-state">H√†ng ƒë·ª£i tr·ªëng</div>
          </div>
        </section>

        <!-- Recent Jobs -->
        <section class="card">
          <h2>üìä Jobs g·∫ßn ƒë√¢y</h2>
          <div class="tabs-container">
            <div class="tab-buttons">
              <button class="tab-btn active" data-target="completed-jobs">Ho√†n th√†nh</button>
              <button class="tab-btn" data-target="failed-jobs">Th·∫•t b·∫°i</button>
            </div>
            <div id="completed-jobs" class="tab-content active">
              <div class="completed-jobs-list" id="completedJobsList">
                <div class="empty-state">Ch∆∞a c√≥ job n√†o ho√†n th√†nh</div>
              </div>
            </div>
            <div id="failed-jobs" class="tab-content">
              <div class="failed-jobs-list" id="failedJobsList">
                <div class="empty-state">Ch∆∞a c√≥ job n√†o th·∫•t b·∫°i</div>
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- Tab 4: Qu·∫£n l√Ω Builds -->
      <div id="builds-tab" class="tab-content">
        <!-- Build Actions Section -->
        <!-- <section class="card">
          <h2>üöÄ Thao t√°c Build</h2>
          <div class="build-actions-grid">
            <button id="startPull" class="action-card">
              <div class="action-icon">üì•</div>
              <div class="action-info">
                <h3>Pull Code</h3>
                <p>K√©o code m·ªõi nh·∫•t t·ª´ repository</p>
              </div>
            </button>
            <button id="runScriptBuild" class="action-card" style="display: none;">
              <div class="action-icon">üìú</div>
              <div class="action-info">
                <h3>Run Script</h3>
                <p>Ch·∫°y script build t√πy ch·ªânh</p>
              </div>
            </button>
            <button id="runDockerBuild" class="action-card">
              <div class="action-icon">üî®</div>
              <div class="action-info">
                <h3>Build & Push</h3>
                <p>Build image v√† push l√™n registry</p>
              </div>
            </button>
            <button id="checkPullBuild" class="action-card primary">
              <div class="action-icon">‚ö°</div>
              <div class="action-info">
                <h3>Manual Pipeline</h3>
                <p>Th·ª±c hi·ªán ngay: Check + Pull + Build</p>
              </div>
            </button>
          </div>
          <div class="build-status">
            <p class="muted">Commit ƒë√£ build g·∫ßn nh·∫•t: <span id="lastBuiltCommit" class="tag">(ch∆∞a c√≥)</span></p>
          </div>
        </section> -->

        <!-- Build History Section -->
        <section class="card full">
          <div class="card-header">
            <h2>üìä L·ªãch s·ª≠ Builds</h2>
            <div class="header-actions">
              <button id="refreshBuilds" class="btn small outline">üîÑ Refresh</button>
              <button id="clearBuildHistory" class="btn small secondary">üóëÔ∏è X√≥a l·ªãch s·ª≠</button>
            </div>
          </div>
          
          <div class="build-filters">
            <input type="text" id="buildSearch" placeholder="üîç T√¨m ki·∫øm builds..." />
            <select id="buildStatusFilter">
              <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
              <option value="success">Th√†nh c√¥ng</option>
              <option value="failed">Th·∫•t b·∫°i</option>
              <option value="running">ƒêang ch·∫°y</option>
            </select>
          </div>

          <div class="builds-table-container">
            <table class="builds-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Th·ªùi gian</th>
                  <th>Commit</th>
                  <th>Branch</th>
                  <th>Ph∆∞∆°ng th·ª©c</th>
                  <th>Tr·∫°ng th√°i</th>
                  <th>Th·ªùi l∆∞·ª£ng</th>
                  <th>H√†nh ƒë·ªông</th>
                </tr>
              </thead>
              <tbody id="buildsTableBody">
                <!-- Build rows will be populated here -->
              </tbody>
            </table>
          </div>
        </section>

        <!-- Real-time Logs Section -->
        <section class="card full" id="logsSection">
          <div class="card-header">
            <h2 id="logsTitle">üìã Logs Realtime</h2>
            <div class="log-toolbar">
              <div class="job-selector">
                <label for="jobSelector">Job:</label>
                <select id="jobSelector" class="select small">
                  <option value="">-- T·∫•t c·∫£ Jobs --</option>
                  <!-- Job options will be populated dynamically -->
                </select>
              </div>
              <button id="copyLogs" class="btn small outline">üìã Copy</button>
              <button id="clearLogs" class="btn small secondary">üóëÔ∏è Clear</button>
              <button id="toggleAutoScroll" class="btn small outline active">üìú Auto Scroll</button>
            </div>
          </div>
          <div id="logs" aria-live="polite" aria-atomic="false" class="logs"></div>
        </section>
      </div>

      <!-- Tab 5: Ch·ªânh s·ª≠a tr·ª±c ti·∫øp config.json -->
      <div id="raw-config-tab" class="tab-content">
        <section class="card full">
          <div class="card-header">
            <h2>üìù Ch·ªânh s·ª≠a tr·ª±c ti·∫øp config.json</h2>
            <div class="header-actions">
              <button id="reloadConfigJson" class="btn small outline">üîÑ T·∫£i l·∫°i</button>
              <button id="formatConfigJson" class="btn small outline">üßπ Format JSON</button>
              <button id="validateConfigJson" class="btn small outline">‚úÖ Validate</button>
              <button id="saveConfigJson" class="btn small">üíæ L∆∞u</button>
            </div>
          </div>
          <p class="muted">C·∫©n tr·ªçng: S·ª≠a sai c·∫•u tr√∫c JSON c√≥ th·ªÉ g√¢y l·ªói h·ªá th·ªëng. H√£y ki·ªÉm tra tr∆∞·ªõc khi l∆∞u.</p>
          <textarea id="configJsonEditor" rows="26" spellcheck="false" placeholder="{\n  \"provider\": \"gitlab\",\n  ...\n}"></textarea>
          <p id="configJsonStatus" class="status"></p>
        </section>

        <section class="card">
          <div class="card-header">
            <h2>üóÇ Phi√™n b·∫£n c·∫•u h√¨nh</h2>
            <div class="header-actions">
              <button id="loadConfigVersions" class="btn small outline">üì• T·∫£i danh s√°ch phi√™n b·∫£n</button>
            </div>
          </div>
          <div id="configVersionsContainer">
            <ul id="configVersionsList" style="list-style: none; padding-left: 0; margin: 0;">
              <!-- Danh s√°ch phi√™n b·∫£n s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
            </ul>
          </div>
        </section>
      </div>

      <!-- Tab 6: Database Configuration -->
      <div id="database-tab" class="tab-content">
        <section class="card">
          <h2>üóÑÔ∏è Database Configuration</h2>
          <p class="muted">Qu·∫£n l√Ω c·∫•u h√¨nh database v√† migration d·ªØ li·ªáu</p>

          <!-- Database Status -->
          <div id="dbStatusSection" class="db-status-section">
            <div class="status-card">
              <div class="status-icon" id="dbStatusIcon">‚è≥</div>
              <div class="status-info">
                <h3 id="dbStatusTitle">ƒêang ki·ªÉm tra...</h3>
                <p id="dbStatusDesc" class="muted">Loading...</p>
              </div>
            </div>
          </div>

          <!-- Database Setup Wizard (shown if not setup) -->
          <div id="dbSetupWizard" style="display: none;">
            <div class="wizard-steps">
              <div class="wizard-step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-label">Ch·ªçn Database</div>
              </div>
              <div class="wizard-step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-label">C·∫•u h√¨nh</div>
              </div>
              <div class="wizard-step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-label">Migration</div>
              </div>
              <div class="wizard-step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-label">Ho√†n t·∫•t</div>
              </div>
            </div>

            <div class="wizard-content">
              <!-- Step 1: Choose Database Type -->
              <div class="step-content active" id="dbStep1">
                <h3>Ch·ªçn lo·∫°i Database</h3>
                <p class="muted">Ch·ªçn database ph√π h·ª£p v·ªõi nhu c·∫ßu c·ªßa b·∫°n</p>

                <div class="db-type-selector">
                  <div class="db-type-card" data-type="sqlite">
                    <div class="db-type-icon">üì¶</div>
                    <div class="db-type-name">SQLite</div>
                    <div class="db-type-desc">
                      File-based, kh√¥ng c·∫ßn c√†i ƒë·∫∑t.<br>
                      Ph√π h·ª£p cho small-medium scale.
                    </div>
                    <div class="db-type-desc" style="margin-top: 10px; font-size: 12px;">
                      ‚úÖ Zero config<br>
                      ‚úÖ D·ªÖ backup<br>
                      ‚úÖ Performance t·ªët
                    </div>
                  </div>

                  <div class="db-type-card" data-type="postgresql">
                    <div class="db-type-icon">üêò</div>
                    <div class="db-type-name">PostgreSQL</div>
                    <div class="db-type-desc">
                      Production-grade database.<br>
                      Ph√π h·ª£p cho large scale.
                    </div>
                    <div class="db-type-desc" style="margin-top: 10px; font-size: 12px;">
                      ‚úÖ Advanced features<br>
                      ‚úÖ High performance<br>
                      ‚úÖ Replication support
                    </div>
                  </div>
                </div>

                <div id="dbExistingDataInfo" class="data-summary" style="display: none;">
                  <h4>üìä D·ªØ li·ªáu hi·ªán t·∫°i</h4>
                  <div class="data-item">
                    <span>Users:</span>
                    <strong id="dbExistingUsers">0</strong>
                  </div>
                  <div class="data-item">
                    <span>Jobs:</span>
                    <strong id="dbExistingJobs">0</strong>
                  </div>
                  <div class="data-item">
                    <span>Config:</span>
                    <strong id="dbExistingConfig">No</strong>
                  </div>
                  <p style="margin-top: 15px; margin-bottom: 0; font-size: 14px;">
                    üí° D·ªØ li·ªáu n√†y s·∫Ω ƒë∆∞·ª£c migrate v√†o database trong b∆∞·ªõc ti·∫øp theo.
                  </p>
                </div>
              </div>

              <!-- Step 2: Configuration -->
              <div class="step-content" id="dbStep2">
                <h3 id="dbStep2Title">C·∫•u h√¨nh Database</h3>
                <p class="muted" id="dbStep2Desc">Nh·∫≠p th√¥ng tin k·∫øt n·ªëi database</p>

                <!-- SQLite Config -->
                <div id="dbSqliteConfig" style="display: none;">
                  <div>
                    <label for="dbSqlitePath">ƒê∆∞·ªùng d·∫´n Database File</label>
                    <input 
                      type="text" 
                      id="dbSqlitePath" 
                      placeholder="vd: ./data/ci-cd.db"
                      value="./data/ci-cd.db"
                    >
                    <small class="muted">Database file s·∫Ω ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông n·∫øu ch∆∞a t·ªìn t·∫°i</small>
                  </div>
                </div>

                <!-- PostgreSQL Config -->
                <div id="dbPostgresqlConfig" style="display: none;">
                  <div class="row">
                    <div>
                      <label for="dbPgHost">Host</label>
                      <input 
                        type="text" 
                        id="dbPgHost" 
                        placeholder="localhost"
                        value="localhost"
                      >
                    </div>
                    <div>
                      <label for="dbPgPort">Port</label>
                      <input 
                        type="number" 
                        id="dbPgPort" 
                        placeholder="5432"
                        value="5432"
                      >
                    </div>
                  </div>

                  <div>
                    <label for="dbPgDatabase">Database Name</label>
                    <input 
                      type="text" 
                      id="dbPgDatabase" 
                      placeholder="cicd_automation"
                      value="cicd_automation"
                    >
                  </div>

                  <div class="row">
                    <div>
                      <label for="dbPgUsername">Username</label>
                      <input 
                        type="text" 
                        id="dbPgUsername" 
                        placeholder="postgres"
                      >
                    </div>
                    <div>
                      <label for="dbPgPassword">Password</label>
                      <input 
                        type="password" 
                        id="dbPgPassword" 
                        placeholder="Enter password"
                      >
                    </div>
                  </div>
                </div>

                <div id="dbConnectionStatus" class="alert" style="display: none; margin-top: 20px;"></div>

                <button id="dbTestConnectionBtn" class="btn secondary" style="margin-top: 20px;">
                  üîç Test Connection
                </button>
              </div>

              <!-- Step 3: Migration -->
              <div class="step-content" id="dbStep3">
                <h3>Data Migration</h3>
                <p class="muted">Migrate d·ªØ li·ªáu t·ª´ JSON files v√†o database</p>

                <div class="data-summary">
                  <h4>üì¶ S·∫Ω migrate:</h4>
                  <div class="data-item">
                    <span>Users:</span>
                    <strong id="dbMigrateUsers">0</strong>
                  </div>
                  <div class="data-item">
                    <span>Jobs:</span>
                    <strong id="dbMigrateJobs">0</strong>
                  </div>
                  <div class="data-item">
                    <span>Config:</span>
                    <strong id="dbMigrateConfig">No</strong>
                  </div>
                </div>

                <div style="margin: 20px 0;">
                  <label>
                    <input type="checkbox" id="dbMigrateDataCheck" checked>
                    Migrate d·ªØ li·ªáu hi·ªán t·∫°i v√†o database
                  </label>
                  <small class="muted" style="display: block; margin-top: 5px;">JSON files s·∫Ω ƒë∆∞·ª£c backup tr∆∞·ªõc khi migrate</small>
                </div>

                <div id="dbMigrationProgress" class="migration-progress" style="display: none;">
                  <h4>üîÑ ƒêang migrate...</h4>
                  
                  <div class="progress-item">
                    <div class="progress-label">
                      <span>Users</span>
                      <span id="dbUsersProgress">0%</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill" id="dbUsersProgressBar" style="width: 0%"></div>
                    </div>
                  </div>

                  <div class="progress-item">
                    <div class="progress-label">
                      <span>Jobs</span>
                      <span id="dbJobsProgress">0%</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill" id="dbJobsProgressBar" style="width: 0%"></div>
                    </div>
                  </div>

                  <div class="progress-item">
                    <div class="progress-label">
                      <span>Config</span>
                      <span id="dbConfigProgress">0%</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill" id="dbConfigProgressBar" style="width: 0%"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Step 4: Complete -->
              <div class="step-content" id="dbStep4">
                <div style="text-align: center;">
                  <div style="font-size: 72px; margin: 30px 0;">‚úÖ</div>
                  <h3>Setup Ho√†n t·∫•t!</h3>
                  <p class="muted">Database ƒë√£ ƒë∆∞·ª£c c·∫•u h√¨nh th√†nh c√¥ng</p>

                  <div class="config-display" id="dbFinalConfig"></div>

                  <div id="dbMigrationSummary" style="margin: 30px 0;"></div>

                  <p style="margin-top: 30px;">
                    üéâ H·ªá th·ªëng ƒë√£ c·∫•u h√¨nh database th√†nh c√¥ng!
                  </p>

                  <button id="dbReloadPageBtn" class="btn primary" style="margin-top: 20px;">
                    üîÑ Reload trang ƒë·ªÉ √°p d·ª•ng
                  </button>
                </div>
              </div>

              <!-- Wizard Actions -->
              <div class="wizard-actions">
                <button id="dbPrevBtn" class="btn secondary" style="display: none;">
                  ‚Üê Quay l·∫°i
                </button>
                <div></div>
                <button id="dbNextBtn" class="btn primary">
                  Ti·∫øp theo ‚Üí
                </button>
              </div>

              <div id="dbErrorMessage" class="alert alert-danger" style="display: none; margin-top: 20px;"></div>
            </div>
          </div>

          <!-- Database Info (shown if setup) -->
          <div id="dbInfoSection" style="display: none;">
            <div class="row" style="margin-top: 20px;">
              <div>
                <label>Database Type</label>
                <p id="dbTypeInfo" style="font-weight: 600;">-</p>
              </div>
              <div>
                <label>Status</label>
                <p id="dbConnectionInfo" style="font-weight: 600; color: var(--success);">‚úÖ Connected</p>
              </div>
            </div>

            <div id="dbConfigInfo" style="margin-top: 20px;">
              <label>Configuration</label>
              <div class="config-display" id="dbConfigDetails"></div>
            </div>

            <div style="margin-top: 30px;">
              <button id="dbManualMigrateBtn" class="btn secondary">
                üîÑ Re-migrate d·ªØ li·ªáu JSON
              </button>
              <button id="dbResetBtn" class="btn danger" style="margin-left: 10px;">
                ‚ö†Ô∏è Reset Database (Dev Only)
              </button>
            </div>
          </div>
        </section>
      </div>

      </main>
    </div>
    
    <!-- Modal ch·ªânh s·ª≠a Build -->
    <div id="modalBackdrop" class="backdrop hidden"></div>
    <div id="modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="editTitle">
      <div class="modal-card">
        <div class="modal-header">
          <h3 id="editTitle">Ch·ªânh s·ª≠a Build</h3>
          <button id="editCancelTop" class="btn small secondary">ƒê√≥ng</button>
        </div>
        <div class="modal-body">
          <label for="editBuildName">T√™n build</label>
          <input id="editBuildName" type="text" />
          <label for="editBuildEnv">ENV (JSON)</label>
          <input id="editBuildEnv" type="text" placeholder='{"NODE_ENV":"production"}' />
          <label for="editBuildSteps">C√°c b∆∞·ªõc (m·ªói d√≤ng 1 l·ªánh)</label>
          <textarea id="editBuildSteps" placeholder="npm ci\nnpm run build\nnpm run test"></textarea>
        </div>
        <div class="modal-actions">
          <button id="editSave" class="btn">L∆∞u</button>
          <button id="editCancel" class="btn outline">H·ªßy</button>
        </div>
      </div>
    </div>

    <div id="jobModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="jobModalTitle">T·∫°o Job m·ªõi</h2>
          <button id="jobModalClose" class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <!-- Basic Info -->
          <div class="form-section">
            <h3>üìù Th√¥ng tin c∆° b·∫£n</h3>
            <label for="jobName">T√™n Job *</label>
            <input id="jobName" type="text" placeholder="VD: Build Backend Services" required />
            
            <label for="jobDescription">M√¥ t·∫£</label>
            <textarea id="jobDescription" placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ job n√†y..."></textarea>
            
            <div class="checkbox-group">
              <input type="checkbox" id="jobEnabled" checked />
              <label for="jobEnabled">K√≠ch ho·∫°t job</label>
            </div>
          </div>

          <!-- Git Configuration -->
          <div class="form-section">
            <h3>üîó C·∫•u h√¨nh Git</h3>
            <div class="row">
              <div>
                <label for="jobGitProvider">Provider</label>
                <select id="jobGitProvider" onchange="updateWebhookUrl()">
                  <option value="gitlab">GitLab</option>
                  <option value="github">GitHub</option>
                </select>
              </div>
              <div>
                <label for="jobGitAccount">Account</label>
                <input id="jobGitAccount" type="text" placeholder="my-org" />
              </div>
            </div>
            
            <div class="row">
              <div>
                <h4 class="form-subheader">üîê Authentication & Token</h4>
                <label for="jobGitToken">Access Token *</label>
                <input id="jobGitToken" type="password" placeholder="ghp_/glpat_..." required />
              </div>
              <div>
                <h4 class="form-subheader">üåø Branch Configuration</h4>
                <label for="jobGitBranch">Default Branch *</label>
                <input id="jobGitBranch" type="text" placeholder="main" required />
                <small class="muted">Branch m·∫∑c ƒë·ªãnh cho job n√†y</small>
              </div>
            </div>
            
            <!-- Multi-Branch Configuration -->
            <div class="form-section">
              <h4 class="form-subheader">üåøüåø Multi-Branch Configuration</h4>
              <div class="info-box">
                <small class="muted">C·∫•u h√¨nh c√°c branch kh√°c m√† b·∫°n mu·ªën build. M·ªói branch c√≥ th·ªÉ c√≥ tag prefix ri√™ng.</small>
              </div>
              
              <div id="branchesContainer">
                <!-- Branches will be dynamically added here -->
              </div>
              
              <button type="button" id="addBranchBtn" class="btn secondary small" style="margin-top: 10px;">
                ‚ûï Th√™m Branch
              </button>
            </div>
            
            <label for="jobGitRepoUrl">Repository URL *</label>
            <input id="jobGitRepoUrl" type="text" placeholder="https://gitlab.com/my-org/my-repo.git" required />
            
            <!-- Local Repository Path ƒë√£ ƒë∆∞·ª£c lo·∫°i b·ªè: h·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông pull v√†o Context/Katalyst/repo -->
          </div>

          <!-- Build Configuration -->
          <div class="form-section">
            <h3>üî® C·∫•u h√¨nh Build</h3>
            <div class="build-method-selector">
              <div class="method-option">
                <input type="radio" id="jobMethodScript" name="jobBuildMethod" value="script" />
                <label for="jobMethodScript">üìú Build theo Script</label>
              </div>
              <div class="method-option">
                <input type="radio" id="jobMethodDocker" name="jobBuildMethod" value="dockerfile" checked />
                <label for="jobMethodDocker">üê≥ Build theo Dockerfile</label>
              </div>
              <div class="method-option">
                <input type="radio" id="jobMethodJson" name="jobBuildMethod" value="jsonfile" />
                <label for="jobMethodJson">üì¶ Build theo JSON Pipeline</label>
              </div>
            </div>
            
            <!-- Use Common Config Button -->
            <div class="common-config-section">
              <button type="button" id="useCommonConfigBtn" class="use-common-config-btn">
                <span>‚öôÔ∏è S·ª≠ d·ª•ng c·∫•u h√¨nh chung</span>
              </button>
              <small class="muted">T·ª± ƒë·ªông ƒëi·ªÅn th√¥ng tin t·ª´ c·∫•u h√¨nh chung (Registry, Docker config)</small>
            </div>
            
            <div class="row">
              <div>
                <label for="jobBuildOrder">Th·ª© t·ª± Build</label>
                <select id="jobBuildOrder">
                  <option value="parallel">Song song (Parallel)</option>
                  <option value="sequential">Tu·∫ßn t·ª± (Sequential)</option>
                </select>
              </div>
            </div>

            <!-- Script Build Config -->
            <div id="jobScriptConfig" class="method-config" style="display: none;">
              <!-- Tr∆∞·ªùng ƒë∆∞·ªùng d·∫´n Script ƒë√£ lo·∫°i b·ªè: h·ªá th·ªëng s·∫Ω s·ª≠ d·ª•ng script m·∫∑c ƒë·ªãnh trong th∆∞ m·ª•c builder -->
              <div class="info-box">
                <small class="muted">Khi ch·ªçn ph∆∞∆°ng th·ª©c Script, h·ªá th·ªëng s·∫Ω t·∫°o th∆∞ m·ª•c: <code>Context/Katalyst/builder/(t√™n-job + job_id)</code>. Vui l√≤ng ƒë·∫∑t file script m·∫∑c ƒë·ªãnh <code>build.sh</code> trong th∆∞ m·ª•c n√†y.</small>
              </div>
              
              <!-- Script Docker Configuration -->
              <div class="row">
                <div>
                  <label for="jobScriptImageName">T√™n Image</label>
                  <input id="jobScriptImageName" type="text" placeholder="my-app" />
                </div>
              </div>
              
              <!-- Script Tag Configuration -->
              <div class="tag-config-section">
                <h4>üè∑Ô∏è C·∫•u H√¨nh Tag</h4>
                <div class="row">
                  <div>
                    <label for="jobScriptImageTagNumber">Ph·∫ßn s·ªë (c√≥ th·ªÉ t·ª± tƒÉng)</label>
                    <input id="jobScriptImageTagNumber" type="text" placeholder="1.0.0" />
                  </div>
                  <div>
                    <label for="jobScriptImageTagText">Ph·∫ßn ch·ªØ (c·ªë ƒë·ªãnh)</label>
                    <input id="jobScriptImageTagText" type="text" placeholder="BETA" />
                  </div>
                </div>
                
                <div class="row">
                  <div>
                    <input type="checkbox" id="jobScriptAutoTagIncrement" />
                    <label for="jobScriptAutoTagIncrement">T·ª± ƒë·ªông tƒÉng ph·∫ßn s·ªë sau m·ªói l·∫ßn build</label>
                  </div>
                </div>
                
                <div class="tag-preview">
                  <small class="muted">Tag cu·ªëi c√πng: <span id="jobScriptTagPreview">1.0.0-BETA</span></small>
                </div>
              </div>
              
              <!-- Script Registry Configuration -->
              <div class="row">
                <div>
                  <label for="jobScriptRegistryUrl">Registry URL</label>
                  <input id="jobScriptRegistryUrl" type="text" placeholder="https://registry.hub.docker.com" />
                </div>
              </div>
              
              <div class="row">
                <div>
                  <label for="jobScriptRegistryUsername">Registry Username</label>
                  <input id="jobScriptRegistryUsername" type="text" placeholder="username" />
                </div>
                <div>
                  <label for="jobScriptRegistryPassword">Registry Password</label>
                  <input id="jobScriptRegistryPassword" type="password" placeholder="password" />
                </div>
              </div>
            </div>

            <!-- Docker Build Config -->
            <div id="jobDockerConfig" class="method-config">
              <div class="row">
                <div>
                  <label for="jobDockerfilePath">Dockerfile Path</label>
                  <input id="jobDockerfilePath" type="text" placeholder="(ƒë·ªÉ tr·ªëng ƒë·ªÉ d√πng Dockerfile m·∫∑c ƒë·ªãnh trong repo)" />
                </div>
                <div>
                  <label for="jobContextPath">Context Path</label>
                  <input id="jobContextPath" type="text" placeholder="(ƒë·ªÉ tr·ªëng ƒë·ªÉ d√πng Context/Katalyst/repo)" />
                </div>
              </div>
              <small class="muted">N·∫øu ƒë·ªÉ tr·ªëng, h·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông pull repo v√†o Context/Katalyst/repo v√† d√πng Dockerfile m·∫∑c ƒë·ªãnh t·∫°i th∆∞ m·ª•c g·ªëc c·ªßa repo khi build.</small>
              
              <div class="row">
                <div>
                  <label for="jobImageName">Image Name *</label>
                  <input id="jobImageName" type="text" placeholder="my-app" />
                </div>
              </div>
              
              <!-- Advanced Tag Configuration -->
              <div class="tag-config-section">
                <h4>üè∑Ô∏è C·∫•u h√¨nh Tag chi ti·∫øt</h4>
                <div class="row">
                  <div>
                    <label for="jobImageTagNumber">Ph·∫ßn s·ªë (c√≥ th·ªÉ t·ª± tƒÉng)</label>
                    <input id="jobImageTagNumber" type="text" placeholder="1.0.75" />
                  </div>
                  <div>
                    <label for="jobImageTagText">Ph·∫ßn ch·ªØ (c·ªë ƒë·ªãnh)</label>
                    <input id="jobImageTagText" type="text" placeholder="BETA" />
                  </div>
                </div>
                
                <div class="checkbox-group">
                  <input type="checkbox" id="jobAutoTagIncrement" />
                  <label for="jobAutoTagIncrement">T·ª± ƒë·ªông tƒÉng ph·∫ßn s·ªë sau m·ªói l·∫ßn build</label>
                </div>
                
                <div class="tag-preview">
                  <small class="muted">Tag cu·ªëi c√πng: <span id="jobTagPreview">1.0.75-BETA</span></small>
                </div>
              </div>
              
              <div class="row">
                <div>
                  <label for="jobRegistryUrl">Registry URL</label>
                  <input id="jobRegistryUrl" type="text" placeholder="harbor.example.com" />
                </div>
                <div>
                  <label for="jobRegistryUsername">Registry Username</label>
                  <input id="jobRegistryUsername" type="text" />
                </div>
              </div>
              
              <label for="jobRegistryPassword">Registry Password</label>
              <input id="jobRegistryPassword" type="password" />
            </div>

            <!-- JSON Pipeline Config -->
            <div id="jobJsonConfig" class="method-config" style="display: none;">
              <div class="info-box">
                <small class="muted">Nh·∫≠p ƒë∆∞·ªùng d·∫´n file JSON pipeline. H·ªá th·ªëng s·∫Ω th·ª±c thi c√°c b∆∞·ªõc theo file, b·ªè qua clone/pull repo m·∫∑c ƒë·ªãnh.</small>
              </div>
              <div class="row">
                <div>
                  <label for="jobJsonPipelinePath">Pipeline JSON File Path *</label>
                  <input id="jobJsonPipelinePath" type="text" placeholder="/home/katalyst/pipelines/initial-build.json" />
                </div>
              </div>
              <small class="muted">JSON h·ªó tr·ª£: pipeline_name, version, working_directory, environment_vars, steps (step_exec, timeout_seconds, on_fail/ignore_failure, shell).</small>
            </div>
          </div>

          <!-- Services Selection -->
          <div id="servicesSection" class="form-section">
            <h3>‚öôÔ∏è Ch·ªçn Services</h3>
            <div class="services-selection">
              <div class="services-header">
                <button type="button" id="selectAllServices" class="btn outline small">Ch·ªçn t·∫•t c·∫£</button>
                <button type="button" id="deselectAllServices" class="btn outline small">B·ªè ch·ªçn t·∫•t c·∫£</button>
              </div>
              <div id="servicesCheckboxes" class="services-checkboxes">
                <!-- Services will be populated here -->
              </div>
            </div>
          </div>

          <!-- Schedule Configuration -->
          <div class="form-section">
            <h3>‚è∞ C·∫•u h√¨nh L·ªãch tr√¨nh</h3>
            
            <!-- Trigger Method Selection -->
            <div class="form-group">
              <label>üéØ Ph∆∞∆°ng th·ª©c Trigger</label>
              <div class="trigger-method-group">
                <label class="trigger-method-option" id="triggerPollingLabel">
                  <input type="radio" name="jobTriggerMethod" id="jobTriggerPolling" value="polling" checked onchange="toggleTriggerMethodConfig(this.value)" />
                  <span>üì° Polling (Default)</span>
                </label>
                <label class="trigger-method-option" id="triggerWebhookLabel">
                  <input type="radio" name="jobTriggerMethod" id="jobTriggerWebhook" value="webhook" onchange="toggleTriggerMethodConfig(this.value)" />
                  <span>‚ö° Webhook (Recommended)</span>
                </label>
                <label class="trigger-method-option" id="triggerHybridLabel">
                  <input type="radio" name="jobTriggerMethod" id="jobTriggerHybrid" value="hybrid" onchange="toggleTriggerMethodConfig(this.value)" />
                  <span>üõ°Ô∏è Hybrid (Safest)</span>
                </label>
              </div>
              <small class="trigger-method-hint" id="triggerMethodHint">
                Polling: Check Git theo chu k·ª≥ | Webhook: Nh·∫≠n events t·ª´ GitLab/GitHub | Hybrid: Webhook + Polling fallback
              </small>
            </div>

            <!-- Webhook Configuration Info (shown when webhook/hybrid selected) -->
            <div id="webhookConfigInfo" class="webhook-config-box" style="display: none;">
              <h4>‚öôÔ∏è C·∫•u h√¨nh Webhook</h4>
              
              <div class="webhook-config-item">
                <label>Webhook URL:</label>
                <div class="webhook-url-group">
                  <input type="text" id="webhookUrlDisplay" readonly onclick="this.select()" />
                  <button type="button" class="btn small primary" onclick="copyWebhookUrl()">üìã Copy</button>
                </div>
              </div>

              <div class="webhook-config-item">
                <label>Secret Token:</label>
                <div class="webhook-url-group">
                  <input type="password" id="webhookSecretDisplay" readonly value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
                  <button type="button" class="btn small outline" onclick="showWebhookSecret()">üëÅÔ∏è Show & Copy</button>
                </div>
                <small>Set trong file .env: WEBHOOK_SECRET=your-secret-token</small>
              </div>

              <div id="webhookInstructions" class="webhook-instructions">
                <strong>üìñ H∆∞·ªõng d·∫´n setup:</strong>
                <div id="gitlabInstructions" style="display: none; margin-top: 8px;">
                  <p style="margin: 4px 0;"><strong>GitLab:</strong></p>
                  <ol>
                    <li>V√†o <code>Settings ‚Üí Webhooks</code> trong GitLab repo</li>
                    <li>Paste <strong>Webhook URL</strong> ·ªü tr√™n</li>
                    <li>Nh·∫≠p <strong>Secret Token</strong></li>
                    <li>Check <strong>"Push events"</strong> v√† ch·ªçn branch</li>
                    <li>Click <strong>"Add webhook"</strong></li>
                  </ol>
                </div>
                <div id="githubInstructions" style="display: none; margin-top: 8px;">
                  <p style="margin: 4px 0;"><strong>GitHub:</strong></p>
                  <ol>
                    <li>V√†o <code>Settings ‚Üí Webhooks ‚Üí Add webhook</code></li>
                    <li>Paste <strong>Webhook URL</strong> ·ªü tr√™n</li>
                    <li>Nh·∫≠p <strong>Secret Token</strong></li>
                    <li>Content type: <strong>application/json</strong></li>
                    <li>Ch·ªçn <strong>"Just the push event"</strong></li>
                    <li>Click <strong>"Add webhook"</strong></li>
                  </ol>
                </div>
              </div>
            </div>
            
            <div class="checkbox-group" id="autoCheckGroup">
              <input type="checkbox" id="jobAutoCheck" onchange="toggleScheduleConfig(this.checked)" />
              <label for="jobAutoCheck">B·∫≠t Auto-Check (cho Polling/Hybrid)</label>
            </div>
            
            <div id="scheduleConfig" style="display: none;">
              <div class="row">
                <div>
                  <label for="jobPolling">Chu k·ª≥ ki·ªÉm tra (gi√¢y)</label>
                  <input id="jobPolling" type="number" value="30" min="5" />
                  <small style="color: #666;">Minimum: 5s (Dev: 30-60s, Hybrid: 300-600s)</small>
                </div>
                <div>
                  <label for="jobCron">Cron Expression (t√πy ch·ªçn)</label>
                  <input id="jobCron" type="text" placeholder="0 */2 * * *" />
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button id="saveJob" class="btn primary">üíæ L∆∞u Job</button>
          <button id="cancelJob" class="btn outline">‚ùå H·ªßy</button>
        </div>
      </div>
    </div>

    <!-- Repository Browser Tab Content -->
    <div id="repository-tab" class="tab-content">
      <div class="card">
        <h2>üìÅ Repository Browser</h2>
        <div class="repository-browser">
          <div class="repo-path-input">
            <label for="repoPathInput">ƒê∆∞·ªùng d·∫´n Repository:</label>
            <div class="path-input-group">
              <input type="text" id="repoPathInput" placeholder="D:\SOURCE-CODE\Katalyst" />
              <button id="browseRepoBtn" class="btn primary">üìÇ Browse</button>
              <button id="loadRepoBtn" class="btn">üîÑ Load</button>
            </div>
            <small class="muted">Nh·∫≠p ƒë∆∞·ªùng d·∫´n th∆∞ m·ª•c repository ƒë·ªÉ xem c·∫•u tr√∫c v√† source code</small>
          </div>

          <div class="breadcrumb" id="repoBreadcrumb">
            <span class="breadcrumb-item" data-path="">Root</span>
          </div>

          <div class="repo-content">
            <div class="repo-sidebar">
              <div class="repo-search">
                <input type="text" id="repoSearchInput" placeholder="üîç T√¨m ki·∫øm file..." />
                <select id="repoSearchType">
                  <option value="all">T·∫•t c·∫£</option>
                  <option value="file">File</option>
                  <option value="directory">Th∆∞ m·ª•c</option>
                </select>
              </div>
              
              <div class="repo-tree" id="repoTree">
                <div class="loading">üìÅ Ch·ªçn repository ƒë·ªÉ b·∫Øt ƒë·∫ßu...</div>
              </div>
            </div>

            <div class="repo-main">
              <div class="file-content" id="fileContent">
                <div class="no-file-selected">
                  <p>üìÑ Ch·ªçn file ƒë·ªÉ xem n·ªôi dung</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Branch Configuration Template -->
    <template id="branchTemplate">
      <div class="branch-item card">
        <div class="branch-header">
          <h5>Branch</h5>
          <button type="button" class="btn danger small icon-btn" title="X√≥a branch">
            üóëÔ∏è
          </button>
        </div>
        <div class="row">
          <div>
            <label>T√™n Branch *</label>
            <input type="text" placeholder="develop" required class="branch-name" />
          </div>
          <div>
            <label>Tag Prefix</label>
            <input type="text" placeholder="DEV" class="branch-tag-prefix" />
            <small class="muted">ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng mu·ªën d√πng prefix</small>
          </div>
        </div>
        
        <!-- C·∫•u h√¨nh Tag chi ti·∫øt cho t·ª´ng branch -->
        <div class="tag-config-section">
          <h4>üè∑Ô∏è C·∫•u h√¨nh Tag chi ti·∫øt</h4>
          <div class="row">
            <div>
              <label>Ph·∫ßn s·ªë (c√≥ th·ªÉ t·ª± tƒÉng)</label>
              <input type="text" placeholder="1.0.0" class="branch-tag-number" />
            </div>
            <div>
              <label>Ph·∫ßn ch·ªØ (c·ªë ƒë·ªãnh)</label>
              <input type="text" placeholder="BETA" class="branch-tag-text" />
            </div>
          </div>
          
          <div class="checkbox-group">
            <input type="checkbox" class="branch-auto-increment" />
            <label>T·ª± ƒë·ªông tƒÉng ph·∫ßn s·ªë sau m·ªói l·∫ßn build</label>
          </div>
          
          <div class="tag-preview">
            <small class="muted">Tag cu·ªëi c√πng: <span class="branch-tag-preview">1.0.0-BETA</span></small>
          </div>
        </div>
        
        <div class="checkbox-group">
          <input type="checkbox" checked class="branch-enabled" />
          <label>K√≠ch ho·∫°t build cho branch n√†y</label>
        </div>
      </div>
    </template>

    <!-- Refactored modular frontend -->
    <script src="/js/database.js"></script>
    <script type="module" src="/js/app.js"></script>
    <script src="/main.js"></script>
  </body>
  </html>