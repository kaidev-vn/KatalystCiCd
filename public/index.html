<!doctype html>
<html lang="vi" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CI/CD Config Panel</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <header class="app-header">
      <div class="brand">
        <div class="logo">‚öôÔ∏è</div>
        <div>
          <h1>CI/CD Control Center</h1>
          <p class="muted">Qu·∫£n l√Ω c·∫•u h√¨nh, build, deploy v√† theo d√µi realtime.</p>
        </div>
      </div>
      <div class="header-actions">
        <button id="themeToggle" class="btn secondary">Ch·∫ø ƒë·ªô t·ªëi</button>
      </div>
    </header>
    <!-- Tab Navigation -->
    <nav class="tab-nav">
      <button class="tab-btn active" data-tab="config-tab">C·∫•u h√¨nh chung</button>
      <button class="tab-btn" data-tab="builds-tab">Qu·∫£n l√Ω Builds</button>
    </nav>

    <main class="container tab-container">
      <!-- Tab 1: C·∫•u h√¨nh chung -->
      <div id="config-tab" class="tab-content active">
        <!-- Git Configuration Section -->
        <section class="card">
          <h2>üîó C·∫•u h√¨nh Git Repository</h2>
          <div class="row">
            <div>
              <label for="provider">Nh√† cung c·∫•p</label>
              <select id="provider">
                <option value="gitlab">GitLab</option>
                <option value="github">GitHub</option>
              </select>
            </div>
            <div>
              <label for="polling">Chu k·ª≥ polling (gi√¢y)</label>
              <input id="polling" type="number" min="5" step="5" placeholder="30" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="account">T√†i kho·∫£n / T·ªï ch·ª©c</label>
              <input id="account" type="text" placeholder="vd: my-org" />
            </div>
            <div>
              <label for="token">Access Token</label>
              <input id="token" type="password" placeholder="ghp_/glpat_..." />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="repoUrl">Repo URL</label>
              <input id="repoUrl" type="text" placeholder="https://gitlab.com/my-org/my-repo.git" />
            </div>
            <div>
              <label for="repoPath">Repo Path (m√°y ch·ªß ch·∫°y pull)</label>
              <input id="repoPath" type="text" placeholder="D:/repos/my-repo" />
            </div>
          </div>
          <div class="row">
            <div>
              <label for="branch">Branch</label>
              <input id="branch" type="text" placeholder="main" />
            </div>
          </div>
          <div class="actions">
            <button id="saveCfg" class="btn">L∆∞u c·∫•u h√¨nh Git</button>
            <button id="checkConnection" class="btn outline">Ki·ªÉm tra k·∫øt n·ªëi</button>
          </div>
          <p id="cfgStatus" class="status"></p>
        </section>

        <!-- Scheduler Status Section -->
        <section class="card">
          <h2>‚è∞ Tr·∫°ng th√°i Scheduler (T·ª± ƒë·ªông Check + Pull + Build)</h2>
          <div class="scheduler-status">
            <div class="status-info">
              <div class="status-item">
                <span class="label">Tr·∫°ng th√°i:</span>
                <span id="schedulerStatus" class="status-badge">-</span>
              </div>
              <div class="status-item">
                <span class="label">Ph∆∞∆°ng th·ª©c Build:</span>
                <span id="schedulerBuildMethod">-</span>
              </div>
              <div class="status-item">
                <span class="label">Chu k·ª≥ Polling:</span>
                <span id="schedulerPolling">-</span>
              </div>
            </div>
            <div class="scheduler-controls">
              <button id="toggleScheduler" class="btn">B·∫≠t/T·∫Øt Scheduler</button>
              <button id="restartScheduler" class="btn outline">Kh·ªüi ƒë·ªông l·∫°i</button>
            </div>
            <div class="scheduler-info">
              <p class="muted">üí° Khi b·∫≠t, scheduler s·∫Ω t·ª± ƒë·ªông ki·ªÉm tra commit m·ªõi v√† th·ª±c hi·ªán build theo chu k·ª≥ ƒë√£ c·∫•u h√¨nh.</p>
            </div>
          </div>
        </section>

        <!-- Build Method Configuration Section -->
        <section class="card">
          <h2>üî® C·∫•u h√¨nh ph∆∞∆°ng th·ª©c Build</h2>
          <div class="build-method-selector">
            <div class="method-option">
              <input type="radio" id="method-script" name="buildMethod" value="script" />
              <label for="method-script" class="method-card">
                <div class="method-icon">üìú</div>
                <div class="method-info">
                  <h3>Build theo Script</h3>
                  <p>S·ª≠ d·ª•ng file .sh t√πy ch·ªânh ƒë·ªÉ build</p>
                </div>
              </label>
            </div>
            <div class="method-option">
              <input type="radio" id="method-dockerfile" name="buildMethod" value="dockerfile" checked />
              <label for="method-dockerfile" class="method-card">
                <div class="method-icon">üê≥</div>
                <div class="method-info">
                  <h3>Build theo Dockerfile</h3>
                  <p>S·ª≠ d·ª•ng Docker ƒë·ªÉ build image</p>
                </div>
              </label>
            </div>
          </div>

          <!-- Script Build Configuration -->
          <div id="script-config" class="method-config" style="display: none;">
            <h3>C·∫•u h√¨nh Script Build</h3>
            <div class="row">
              <div>
                <label for="deployScriptPath">ƒê∆∞·ªùng d·∫´n Script (.sh)</label>
                <input id="deployScriptPath" type="text" placeholder="vd: D:/Ci-Cd/deploy.sh" />
                <p class="muted">Nh·∫≠p ƒë∆∞·ªùng d·∫´n ƒë·∫øn file script ƒë·ªÉ th·ª±c hi·ªán build.</p>
              </div>
            </div>
          </div>

          <!-- Dockerfile Build Configuration -->
          <div id="dockerfile-config" class="method-config">
            <h3>C·∫•u h√¨nh Docker Build</h3>
            <div class="row">
              <div>
                <label for="dockerfilePath">Dockerfile Path</label>
                <input id="dockerfilePath" type="text" placeholder="D:/repos/my-repo/Dockerfile" />
              </div>
              <div>
                <label for="contextPath">Context Path</label>
                <input id="contextPath" type="text" placeholder="D:/repos/my-repo" />
              </div>
            </div>
            <div class="row">
              <div>
                <label for="imageName">Image Name</label>
                <input id="imageName" type="text" placeholder="my-registry.com/myproj/myapp" />
              </div>
              <div>
                <label for="imageTag">Image Tag</label>
                <input id="imageTag" type="text" placeholder="latest" />
                <div class="check-inline mt6">
                  <input id="autoTagIncrement" class="switch" type="checkbox" />
                  <span class="muted">T·ª± ƒë·ªông tƒÉng tag sau m·ªói l·∫ßn build</span>
                </div>
              </div>
            </div>
            <div class="row">
              <div>
                <label for="registryUrl">Registry URL</label>
                <input id="registryUrl" type="text" placeholder="my-registry.com" />
              </div>
              <div>
                <label for="registryUsername">Registry Username</label>
                <input id="registryUsername" type="text" placeholder="username" />
              </div>
            </div>
            <div class="row">
              <div>
                <label for="registryPassword">Registry Password</label>
                <input id="registryPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
              </div>
              <div></div>
            </div>
          </div>

          <!-- Docker Swarm Configuration -->
          <div class="swarm-config">
            <h3>üêã C·∫•u h√¨nh Docker Swarm Deploy</h3>
            <div class="row">
              <div>
                <label for="composePath">docker-compose.yml Path</label>
                <input id="composePath" type="text" placeholder="D:/deploy/compose.yml" />
              </div>
              <div>
                <label for="stackName">Swarm Stack Name</label>
                <input id="stackName" type="text" placeholder="my-stack" />
              </div>
            </div>
            <div class="row">
              <div>
                <label for="autoDeploySwarm">Auto Deploy Swarm</label>
                <div class="check-inline">
                  <input id="autoDeploySwarm" class="switch" type="checkbox" />
                  <span class="muted">Deploy Swarm t·ª± ƒë·ªông sau khi build th√†nh c√¥ng</span>
                </div>
              </div>
            </div>
          </div>

          <div class="actions">
            <button id="saveAllConfig" class="btn primary">üíæ L∆∞u t·∫•t c·∫£ c·∫•u h√¨nh</button>
            <button id="testBuild" class="btn outline">üß™ Test Build</button>
          </div>
        </section>
      </div>

      <!-- Tab 2: Qu·∫£n l√Ω Builds -->
      <div id="builds-tab" class="tab-content">
        <!-- Build Actions Section -->
        <section class="card">
          <h2>üöÄ Thao t√°c Build</h2>
          <div class="build-actions-grid">
            <button id="startPull" class="action-card">
              <div class="action-icon">üì•</div>
              <div class="action-info">
                <h3>Pull Code</h3>
                <p>K√©o code m·ªõi nh·∫•t t·ª´ repository</p>
              </div>
            </button>
            <button id="runScriptBuild" class="action-card" style="display: none;">
              <div class="action-icon">üìú</div>
              <div class="action-info">
                <h3>Run Script</h3>
                <p>Ch·∫°y script build t√πy ch·ªânh</p>
              </div>
            </button>
            <button id="runDockerBuild" class="action-card">
              <div class="action-icon">üî®</div>
              <div class="action-info">
                <h3>Build & Push</h3>
                <p>Build image v√† push l√™n registry</p>
              </div>
            </button>
            <button id="runSwarmDeploy" class="action-card">
              <div class="action-icon">üêã</div>
              <div class="action-info">
                <h3>Deploy Swarm</h3>
                <p>Deploy l√™n Docker Swarm</p>
              </div>
            </button>
            <button id="checkPullBuild" class="action-card primary">
              <div class="action-icon">‚ö°</div>
              <div class="action-info">
                <h3>Manual Pipeline</h3>
                <p>Th·ª±c hi·ªán ngay: Check + Pull + Build</p>
              </div>
            </button>
          </div>
          <div class="build-status">
            <p class="muted">Commit ƒë√£ build g·∫ßn nh·∫•t: <span id="lastBuiltCommit" class="tag">(ch∆∞a c√≥)</span></p>
          </div>
        </section>

        <!-- Build History Section -->
        <section class="card full">
          <div class="card-header">
            <h2>üìä L·ªãch s·ª≠ Builds</h2>
            <div class="header-actions">
              <button id="refreshBuilds" class="btn small outline">üîÑ Refresh</button>
              <button id="clearBuildHistory" class="btn small secondary">üóëÔ∏è X√≥a l·ªãch s·ª≠</button>
            </div>
          </div>
          
          <div class="build-filters">
            <input type="text" id="buildSearch" placeholder="üîç T√¨m ki·∫øm builds..." />
            <select id="buildStatusFilter">
              <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
              <option value="success">Th√†nh c√¥ng</option>
              <option value="failed">Th·∫•t b·∫°i</option>
              <option value="running">ƒêang ch·∫°y</option>
            </select>
          </div>

          <div class="builds-table-container">
            <table class="builds-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Th·ªùi gian</th>
                  <th>Commit</th>
                  <th>Branch</th>
                  <th>Ph∆∞∆°ng th·ª©c</th>
                  <th>Tr·∫°ng th√°i</th>
                  <th>Th·ªùi l∆∞·ª£ng</th>
                  <th>H√†nh ƒë·ªông</th>
                </tr>
              </thead>
              <tbody id="buildsTableBody">
                <!-- Build rows will be populated here -->
              </tbody>
            </table>
          </div>
        </section>

        <!-- Real-time Logs Section -->
        <section class="card full" id="logsSection">
          <div class="card-header">
            <h2 id="logsTitle">üìã Logs Realtime</h2>
            <div class="log-toolbar">
              <button id="copyLogs" class="btn small outline">üìã Copy</button>
              <button id="clearLogs" class="btn small secondary">üóëÔ∏è Clear</button>
              <button id="toggleAutoScroll" class="btn small outline active">üìú Auto Scroll</button>
            </div>
          </div>
          <div id="logs" aria-live="polite" aria-atomic="false" class="logs"></div>
        </section>
      </div>
    </main>
    
    <!-- Modal ch·ªânh s·ª≠a Build -->
    <div id="modalBackdrop" class="backdrop hidden"></div>
    <div id="modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="editTitle">
      <div class="modal-card">
        <div class="modal-header">
          <h3 id="editTitle">Ch·ªânh s·ª≠a Build</h3>
          <button id="editCancelTop" class="btn small secondary">ƒê√≥ng</button>
        </div>
        <div class="modal-body">
          <label for="editBuildName">T√™n build</label>
          <input id="editBuildName" type="text" />
          <label for="editBuildEnv">ENV (JSON)</label>
          <input id="editBuildEnv" type="text" placeholder='{"NODE_ENV":"production"}' />
          <label for="editBuildSteps">C√°c b∆∞·ªõc (m·ªói d√≤ng 1 l·ªánh)</label>
          <textarea id="editBuildSteps" placeholder="npm ci\nnpm run build\nnpm run test"></textarea>
        </div>
        <div class="modal-actions">
          <button id="editSave" class="btn">L∆∞u</button>
          <button id="editCancel" class="btn outline">H·ªßy</button>
        </div>
      </div>
    </div>

    <script src="/main.js"></script>
  </body>
  </html>